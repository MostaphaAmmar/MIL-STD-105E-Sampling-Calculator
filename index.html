<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIL-STD-105E Sampling Calculator</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    select, input, button { margin-bottom: 15px; padding: 8px; width: 100%; }
    .result { margin-top: 20px; font-weight: bold; font-size: 18px; }
    .accepted { color: green; }
    .rejected { color: red; }
    .hidden { display: none; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .logo { max-height: 80px; }
</style>
</head>
<body>

<div class="header">
    <img src="Scitra logo.jpg" alt="Scitra Logo" class="logo">
    <div>
        <h2>QC Section</h2>
        <h3>Quality Department</h3>
    </div>
</div>

<h1>MIL-STD-105E / ISO 2859-1 Sampling Calculator1</h1>

<label>Lot Size (Numeric Value):</label>
<input type="number" id="lotSize" min="300" placeholder="Enter total lot quantity">

<label>General Inspection Level:</label>
<select id="inspectionLevel">
    <option value="I">Level I</option>
    <option value="II" selected>Level II (Default)</option>
    <option value="III">Level III</option>
</select>

<label>Inspection Status (Switching Rule):</label>
<select id="inspectionStatus">
    <option value="normal">Normal</option>
    <option value="tightened">Tightened</option>
    <option value="reduced">Reduced</option>
</select>

<button onclick="calculateSampleSize()">Calculate Sample Size</button>

<div class="result" id="sampleSize"></div>

<div id="defectSection" class="hidden">

<label>Defect Category (AQL):</label>
<select id="defectType">
    <option value="critical">Critical (AQL 0.0)</option>
    <option value="major">Major (AQL 1.0)</option>
    <option value="minor">Minor (AQL 4.0)</option>
</select>

<label>Number of Defects Found:</label>
<input type="number" id="defectCount" min="0">

<button onclick="calculateAcceptance()">Calculate Acceptance Decision</button>

<div class="result" id="result"></div>

</div>

<script>
// MIL-STD-105E: Normal Inspection Sample Size Table by Code Letter
const normalTable = {
    A: 2, B: 3, C: 5, D: 8, E: 13, F: 20, G: 32, H: 50, J: 80, K: 125, L: 200, M: 315, N: 500, P: 800
};

// Reduced Inspection Table
const reducedTable = {
    A: 2, B: 2, C: 3, D: 5, E: 8, F: 13, G: 20, H: 32, J: 50, K: 80, L: 80, M: 125, N: 200, P: 315
};

// Tightened Inspection Table
const tightenedTable = {
    A: 3, B: 5, C: 8, D: 13, E: 20, F: 32, G: 50, H: 80, J: 125, K: 200, L: 315, M: 500, N: 800, P: 1250
};

// Determine code letter based on lot size and inspection level
function getCodeLetter(lotSize, inspectionLevel) {
    let letter = 'A';
    if (lotSize <= 500) letter = 'B';
    else if (lotSize <= 1200) letter = 'C';
    else if (lotSize <= 3200) letter = 'D';
    else if (lotSize <= 10000) letter = 'L'; // 3960 → L
    else if (lotSize <= 35000) letter = 'M';
    else if (lotSize <= 150000) letter = 'N';
    else if (lotSize <= 500000) letter = 'P';
    else letter = 'P';
    return letter;
}

// Get sample size from proper table
function getSampleSize(letter, status) {
    if (status === 'normal') return normalTable[letter];
    if (status === 'reduced') return reducedTable[letter];
    if (status === 'tightened') return tightenedTable[letter];
    return normalTable[letter];
}

let currentSampleSize = 0;

function calculateSampleSize() {
    const lotSize = parseInt(document.getElementById('lotSize').value);
    const inspectionLevel = document.getElementById('inspectionLevel').value;
    const inspectionStatus = document.getElementById('inspectionStatus').value;

    if (isNaN(lotSize) || lotSize < 300) {
        alert("Lot size must be 300 or greater.");
        return;
    }

    const codeLetter = getCodeLetter(lotSize, inspectionLevel);
    currentSampleSize = getSampleSize(codeLetter, inspectionStatus);

    document.getElementById('sampleSize').textContent =
        `Lot Size: ${lotSize} → Code Letter: ${codeLetter} → Sample Size (${inspectionStatus.toUpperCase()}): ${currentSampleSize} units`;

    document.getElementById('defectSection').classList.remove('hidden');
    document.getElementById('result').textContent = "";
}

// Dynamic AQL Calculation
function calculateAcceptance() {
    const defectType = document.getElementById('defectType').value;
    const defectCount = parseInt(document.getElementById('defectCount').value);

    if (isNaN(defectCount)) {
        alert("Please enter number of defects.");
        return;
    }

    let aqlRate;
    if (defectType === "critical") aqlRate = 0.0001;
    if (defectType === "major") aqlRate = 0.01;
    if (defectType === "minor") aqlRate = 0.04;

    const Ac = Math.floor(currentSampleSize * aqlRate);
    const Re = Ac + 1;

    const resultElement = document.getElementById('result');

    if (defectCount <= Ac) {
        resultElement.textContent =
            `ACCEPTED (Ac=${Ac}, Re=${Re}) – Lot meets AQL requirement`;
        resultElement.className = 'result accepted';
    } else {
        resultElement.textContent =
            `REJECTED (Ac=${Ac}, Re=${Re}) – Lot does not meet AQL requirement`;
        resultElement.className = 'result rejected';
    }
}
</script>

</body>
</html>
